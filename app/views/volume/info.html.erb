<!-- page content -->

<div class="right_col" role="main">
  <div class="">
    <div class="page-title">
      <div class="title_left">
        <h3>Volume Info </h3> 
      </div>
      <div class="title_right">
        <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Search for...">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button">Go!</button>
              </span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="clearfix"></div>

    <div class="row">  
    
      <%@volumes.each do |t|%>
      
        <div class="col-md-12 col-sm-12 col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Infomation <small><%=t["Volume Name"]%></small></h2>
              <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Settings 1</a>
                    </li>
                    <li><a href="#">Settings 2</a>
                    </li>
                  </ul>
                </li>
                <li><a class="close-link"><i class="fa fa-close"></i></a>
                </li>
              </ul>
              <div class="clearfix"></div>
            </div>
            
            <div class="x_content">
              
              <div class="col-md-4 col-sm-4 col-xs-4">
                Type : <%=t["Type"]%> <br>
                Volume ID : <%=t["Volume ID"]%> <br>
                Status : <%=t["Status"]%> <br>
                Number of Bricks : <%=t["Number of Bricks"]%> <br>
                Transport-type : <%=t["Transport-type"]%> <br>
                Bricks : <%=t["Bricks"]%> <br>
                Bricks1 : <%=t["Brick1"]%> <br>
                Options Reconfigured : <%=t["Options Reconfigured"]%> <br>
                performance.readdir-ahead : <%=t["performance.readdir-ahead"]%> <br>
              </div>
              
              <div class="col-md-8 col-sm-8 col-xs-8">
                <p>Drag multiple files to the box below for multi upload or click to select files.</p>
                <form action="/file_upload" method="post" enctype="multipart/form-data" class="dropzone" style="border: 1px solid #e5e5e5; height: 300px; overflow:auto;">
                </form>
                <br/>
              </div>
              
              <div class="col-md-12 col-sm-12 col-xs-12" id="table_div">
                  <p class="text-muted font-13 m-b-30"><code>File Manager</code></p>
                  <p>  Current directory : <%=@current_dir%></p></br>
                  <table id="datatable" class="table table-striped table-bordered jambo_table">
                    <thead>
                      <tr class="headings">
                        <th>Name</th>
                        <th>auth</th>
                        <th>Size</th>
                        <th>Date</th>
                      </tr>
                    </thead>

                    <tbody id="tbody_volume1">
                      <tr>
                        <td><i class="fa fa-reply"></i> 
                           <a onclick="change_upper('<%=@current_dir%>')">  ..</a>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                      </tr>
                      <%@files.each do |t|%>
                        <tr>
                          <% if t["auth"][0]=='d'%> 
                           <td style="color:#0d8ade;"><i class="fa fa-folder-open-o"></i> 
                             <a style="cursor: pointer" onclick="change_directory('<%=@current_dir + "/" + t["name"]%>')"><%=t["name"]%></a>
                            </td>
                          <% else %>
                           <td><i class="fa fa-file-o"></i> 
                             <a style="cursor: pointer"><%=t["name"]%></a>
                           </td>
                          <% end %>
                         <td><%=t["auth"]%></td>
                         <td><%=t["size"]%></td>
                         <td><%=t["date"]%></td>
                        </tr>
                      <%end%>
                    </tbody>
                  </table>
              </div>
            </div>
          </div>
        </div>
      <%end%>
    </div>
  </div>
</div>
<!-- /page content -->

  <script>
          var handleDataTableButtons = function() {
              "use strict";
              0 !== $("#datatable-buttons").length && $("#datatable-buttons").DataTable({
                dom: "Bfrtip",
                buttons: [{
                  extend: "copy",
                  className: "btn-sm"
                }, {
                  extend: "csv",
                  className: "btn-sm"
                }, {
                  extend: "excel",
                  className: "btn-sm"
                }, {
                  extend: "pdf",
                  className: "btn-sm"
                }, {
                  extend: "print",
                  className: "btn-sm"
                }],
                responsive: !0
              })
            },
            TableManageButtons = function() {
              "use strict";
              return {
                init: function() {
                  handleDataTableButtons()
                }
              }
            }();
  </script>
  <script type="text/javascript">
          $(document).ready(function() {
            $('#datatable').dataTable();
          });
          TableManageButtons.init();
  </script>
  
  
  
  <script>
    function change_upper(directory){
      if(directory != "/"){
        var path = directory.split("/");
        var upper_path = "";
        if(path.length == 2){
          change_directory("/");
        } else {
          for(var i = 1; i < path.length - 1 ; i++){
             if(path[i] != "")
              upper_path += "/" + path[i];
          }
          change_directory(upper_path);
        }
      }
    }
    
    function change_directory(directory){
      $.ajax({
      method: "POST",
      url: "/volume/changeDir",
      data: { path: directory },
      success  : function(result){
          $("#table_div").empty();
          var new_table = "<p class='text-muted font-13 m-b-30'><code>File Manager</code></p>";
          new_table += "<p>Current directory : " + directory + "</p></br>";
          new_table += "<table id='datatable' class='table table-striped table-bordered jambo_table'>";
          new_table += "<thead>";
          new_table += "<tr class='headings'>";
          new_table += "<th>Name</th>";
          new_table += "<th>Auth</th>";
          new_table += "<th>Size</th>";
          new_table += "<th>Date</th>";
          new_table += "</tr>";
          new_table += "</thead>";
          new_table += "<tbody id='tbody_volume1'>";
          
          var new_tr = "<tr role='row' class='odd'> <td><i class='fa fa-reply'></i>";
          new_tr += "<a onclick='change_upper(" + '"' + directory + '"' +")'> ..</a>";
          new_tr += "</td><td> </td><td> </td><td> </td></tr>";
          
          for( var i = 0; i < result.file.length; i++){
            if(i % 2 == 0)
              new_tr += "<tr role='row' class='odd'>";
            else
              new_tr += "<tr role='row' class='even'>";
            if(result.file[i].auth[0] == "d"){
              new_tr += "<td style='color:#0d8ade;' class='sorting_1'><i class='fa fa-folder-open-o'></i> "; 
              if(result.current != "/")
                new_tr += "<a  style='cursor: pointer'  onclick='change_directory(" +'"' + result.current + "/" + result.file[i].name +'"'+ ")'>" + result.file[i].name + "</a></td>";
              else
                new_tr += "<a  style='cursor: pointer'  onclick='change_directory(" +'"' + "/" + result.file[i].name +'"'+ ")'>" + result.file[i].name + "</a></td>";
            }else{
              new_tr += "<td><i class='fa fa-file-o'></i><a style='cursor: pointer'>" + result.file[i].name + "</a></td>";
            }
            new_tr += "<td>"+result.file[i].auth+"</td>";
            new_tr += "<td>"+result.file[i].size+"</td>";
            new_tr += "<td>"+result.file[i].date+"</td>";
            new_tr += "</tr>";
          }
          
          new_table += new_tr;
          new_table += "</tbody></table>"
          $("#table_div").append(new_table);

          $('#datatable').dataTable();
          TableManageButtons.init();
        }
      })
    }
  </script>
